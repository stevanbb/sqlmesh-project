import{r as d,R as le,g as ke,j as t,c as b,i as I,v as B,f as lt,b as R,a as D,m as P,I as de,B as A,l as _,aj as nt,H as re,S as we,P as Ee,a6 as Qe,a7 as rt,a8 as at,ak as qe,_ as ot,d as Ve,s as it,e as ct,q as dt,F as Q,D as ut,a9 as ft,al as mt}from"./index-176b79a9.js";import{u as ee,M as xt}from"./project-e6dc9a02.js";import{S as Be}from"./SplitPane-94158256.js";import{E as Z,M as ht}from"./file-d5b08b04.js";import{u as N}from"./editor-d35a2632.js";import{I as E}from"./Input-a01139a4.js";import{X as pt,L as gt}from"./ListboxShow-71b4cfa2.js";import{B as We}from"./Banner-0af92f6f.js";import{f as bt,c as Ye,b as vt,S as He,D as ue,y as fe,K as Pe,o as K,g as ve,X as me,I as Xe,z as jt,u as ce,H as ie,N as ge,A as wt,r as W,O as se,M as H,t as Nt}from"./transition-19ed7834.js";import{g as Re,G as yt,F as Tt,T as Et}from"./help-5b3b060e.js";import{M as Pt,u as Je,a as De,b as St,c as Ct,C as It}from"./context-4c50fddd.js";import{v as Se,M as kt,P as Dt}from"./PlusCircleIcon-2799ca1f.js";import{D as Mt}from"./ReportErrors-64911a07.js";import"./index-ae36976e.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./help-68063aae.js";import"./SourceList-a47c6829.js";function Rt({onFocus:e}){let[s,l]=d.useState(!0),n=bt();return s?le.createElement(Ye,{as:"button",type:"button",features:vt.Focusable,onFocus:c=>{c.preventDefault();let r,i=50;function u(){if(i--<=0){r&&cancelAnimationFrame(r);return}if(e()){if(cancelAnimationFrame(r),!n.current)return;l(!1);return}r=requestAnimationFrame(u)}r=requestAnimationFrame(u)}}):null}const Ze=d.createContext(null);function Lt(){return{groups:new Map,get(e,s){var l;let n=this.groups.get(e);n||(n=new Map,this.groups.set(e,n));let c=(l=n.get(s))!=null?l:0;n.set(s,c+1);let r=Array.from(n.keys()).indexOf(s);function i(){let u=n.get(s);u>1?n.set(s,u-1):n.delete(s)}return[r,i]}}}function _t({children:e}){let s=d.useRef(Lt());return d.createElement(Ze.Provider,{value:s},e)}function Ke(e){let s=d.useContext(Ze);if(!s)throw new Error("You must wrap your component in a <StableCollection>");let l=Ft(),[n,c]=s.current.get(e,l);return d.useEffect(()=>c,[]),n}function Ft(){var e,s,l;let n=(l=(s=(e=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)==null?void 0:e.ReactCurrentOwner)==null?void 0:s.current)!=null?l:null;if(!n)return Symbol();let c=[],r=n;for(;r;)c.push(r.index),r=r.return;return"$."+c.join(".")}var At=(e=>(e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e))(At||{}),zt=(e=>(e[e.Less=-1]="Less",e[e.Equal=0]="Equal",e[e.Greater=1]="Greater",e))(zt||{}),$t=(e=>(e[e.SetSelectedIndex=0]="SetSelectedIndex",e[e.RegisterTab=1]="RegisterTab",e[e.UnregisterTab=2]="UnregisterTab",e[e.RegisterPanel=3]="RegisterPanel",e[e.UnregisterPanel=4]="UnregisterPanel",e))($t||{});let Ot={0(e,s){var l;let n=ie(e.tabs,f=>f.current),c=ie(e.panels,f=>f.current),r=n.filter(f=>{var g;return!((g=f.current)!=null&&g.hasAttribute("disabled"))}),i={...e,tabs:n,panels:c};if(s.index<0||s.index>n.length-1){let f=ce(Math.sign(s.index-e.selectedIndex),{[-1]:()=>1,0:()=>ce(Math.sign(s.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(r.length===0)return i;let g=ce(f,{0:()=>n.indexOf(r[0]),1:()=>n.indexOf(r[r.length-1])});return{...i,selectedIndex:g===-1?e.selectedIndex:g}}let u=n.slice(0,s.index),p=[...n.slice(s.index),...u].find(f=>r.includes(f));if(!p)return i;let a=(l=n.indexOf(p))!=null?l:e.selectedIndex;return a===-1&&(a=e.selectedIndex),{...i,selectedIndex:a}},1(e,s){var l;if(e.tabs.includes(s.tab))return e;let n=e.tabs[e.selectedIndex],c=ie([...e.tabs,s.tab],i=>i.current),r=(l=c.indexOf(n))!=null?l:e.selectedIndex;return r===-1&&(r=e.selectedIndex),{...e,tabs:c,selectedIndex:r}},2(e,s){return{...e,tabs:e.tabs.filter(l=>l!==s.tab)}},3(e,s){return e.panels.includes(s.panel)?e:{...e,panels:ie([...e.panels,s.panel],l=>l.current)}},4(e,s){return{...e,panels:e.panels.filter(l=>l!==s.panel)}}},Le=d.createContext(null);Le.displayName="TabsDataContext";function ne(e){let s=d.useContext(Le);if(s===null){let l=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,ne),l}return s}let _e=d.createContext(null);_e.displayName="TabsActionsContext";function Fe(e){let s=d.useContext(_e);if(s===null){let l=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,Fe),l}return s}function Qt(e,s){return ce(s.type,Ot,e,s)}let Bt=d.Fragment;function Wt(e,s){let{defaultIndex:l=0,vertical:n=!1,manual:c=!1,onChange:r,selectedIndex:i=null,...u}=e;const p=n?"vertical":"horizontal",a=c?"manual":"auto";let f=i!==null,g=fe(s),[w,x]=d.useReducer(Qt,{selectedIndex:i??l,tabs:[],panels:[]}),v=d.useMemo(()=>({selectedIndex:w.selectedIndex}),[w.selectedIndex]),M=Pe(r||(()=>{})),j=Pe(w.tabs),o=d.useMemo(()=>({orientation:p,activation:a,...w}),[p,a,w]),y=K(C=>(x({type:1,tab:C}),()=>x({type:2,tab:C}))),m=K(C=>(x({type:3,panel:C}),()=>x({type:4,panel:C}))),S=K(C=>{U.current!==C&&M.current(C),f||x({type:0,index:C})}),U=Pe(f?e.selectedIndex:w.selectedIndex),ae=d.useMemo(()=>({registerTab:y,registerPanel:m,change:S}),[]);ve(()=>{x({type:0,index:i??l})},[i]),ve(()=>{if(U.current===void 0||w.tabs.length<=0)return;let C=ie(w.tabs,z=>z.current);C.some((z,T)=>w.tabs[T]!==z)&&S(C.indexOf(w.tabs[U.current]))});let J={ref:g};return le.createElement(_t,null,le.createElement(_e.Provider,{value:ae},le.createElement(Le.Provider,{value:o},o.tabs.length<=0&&le.createElement(Rt,{onFocus:()=>{var C,z;for(let T of j.current)if(((C=T.current)==null?void 0:C.tabIndex)===0)return(z=T.current)==null||z.focus(),!0;return!1}}),me({ourProps:J,theirProps:u,slot:v,defaultTag:Bt,name:"Tabs"}))))}let Ht="div";function Gt(e,s){let{orientation:l,selectedIndex:n}=ne("Tab.List"),c=fe(s);return me({ourProps:{ref:c,role:"tablist","aria-orientation":l},theirProps:e,slot:{selectedIndex:n},defaultTag:Ht,name:"Tabs.List"})}let Ut="button";function qt(e,s){var l,n;let c=Xe(),{id:r=`headlessui-tabs-tab-${c}`,...i}=e,{orientation:u,activation:p,selectedIndex:a,tabs:f,panels:g}=ne("Tab"),w=Fe("Tab"),x=ne("Tab"),v=d.useRef(null),M=fe(v,s);ve(()=>w.registerTab(v),[w,v]);let j=Ke("tabs"),o=f.indexOf(v);o===-1&&(o=j);let y=o===a,m=K(T=>{var $;let te=T();if(te===ge.Success&&p==="auto"){let Te=($=wt(v))==null?void 0:$.activeElement,oe=x.tabs.findIndex(pe=>pe.current===Te);oe!==-1&&w.change(oe)}return te}),S=K(T=>{let $=f.map(te=>te.current).filter(Boolean);if(T.key===W.Space||T.key===W.Enter){T.preventDefault(),T.stopPropagation(),w.change(o);return}switch(T.key){case W.Home:case W.PageUp:return T.preventDefault(),T.stopPropagation(),m(()=>se($,H.First));case W.End:case W.PageDown:return T.preventDefault(),T.stopPropagation(),m(()=>se($,H.Last))}if(m(()=>ce(u,{vertical(){return T.key===W.ArrowUp?se($,H.Previous|H.WrapAround):T.key===W.ArrowDown?se($,H.Next|H.WrapAround):ge.Error},horizontal(){return T.key===W.ArrowLeft?se($,H.Previous|H.WrapAround):T.key===W.ArrowRight?se($,H.Next|H.WrapAround):ge.Error}}))===ge.Success)return T.preventDefault()}),U=d.useRef(!1),ae=K(()=>{var T;U.current||(U.current=!0,(T=v.current)==null||T.focus({preventScroll:!0}),w.change(o),Nt(()=>{U.current=!1}))}),J=K(T=>{T.preventDefault()}),C=d.useMemo(()=>({selected:y}),[y]),z={ref:M,onKeyDown:S,onMouseDown:J,onClick:ae,id:r,role:"tab",type:jt(e,v),"aria-controls":(n=(l=g[o])==null?void 0:l.current)==null?void 0:n.id,"aria-selected":y,tabIndex:y?0:-1};return me({ourProps:z,theirProps:i,slot:C,defaultTag:Ut,name:"Tabs.Tab"})}let Vt="div";function Yt(e,s){let{selectedIndex:l}=ne("Tab.Panels"),n=fe(s),c=d.useMemo(()=>({selectedIndex:l}),[l]);return me({ourProps:{ref:n},theirProps:e,slot:c,defaultTag:Vt,name:"Tabs.Panels"})}let Xt="div",Jt=He.RenderStrategy|He.Static;function Zt(e,s){var l,n,c,r;let i=Xe(),{id:u=`headlessui-tabs-panel-${i}`,tabIndex:p=0,...a}=e,{selectedIndex:f,tabs:g,panels:w}=ne("Tab.Panel"),x=Fe("Tab.Panel"),v=d.useRef(null),M=fe(v,s);ve(()=>x.registerPanel(v),[x,v]);let j=Ke("panels"),o=w.indexOf(v);o===-1&&(o=j);let y=o===f,m=d.useMemo(()=>({selected:y}),[y]),S={ref:M,id:u,role:"tabpanel","aria-labelledby":(n=(l=g[o])==null?void 0:l.current)==null?void 0:n.id,tabIndex:y?p:-1};return!y&&((c=a.unmount)==null||c)&&!((r=a.static)!=null&&r)?le.createElement(Ye,{as:"span",...S}):me({ourProps:S,theirProps:a,slot:m,defaultTag:Xt,features:Jt,visible:y,name:"Tabs.Panel"})}let Kt=ue(qt),es=ue(Wt),ts=ue(Gt),ss=ue(Yt),ls=ue(Zt),k=Object.assign(Kt,{Group:es,List:ts,Panels:ss,Panel:ls});function ns({title:e,titleId:s,...l},n){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:n,"aria-labelledby":s},l),e?d.createElement("title",{id:s},e):null,d.createElement("path",{fillRule:"evenodd",d:"M3 6.75A.75.75 0 013.75 6h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 6.75zM3 12a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zm0 5.25a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z",clipRule:"evenodd"}))}const rs=d.forwardRef(ns),et=rs;function as({title:e,titleId:s,...l},n){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:n,"aria-labelledby":s},l),e?d.createElement("title",{id:s},e):null,d.createElement("path",{fillRule:"evenodd",d:"M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z",clipRule:"evenodd"}))}const os=d.forwardRef(as),is=os;function cs({title:e,titleId:s,...l},n){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:n,"aria-labelledby":s},l),e?d.createElement("title",{id:s},e):null,d.createElement("path",{d:"M15 3.75H9v16.5h6V3.75zM16.5 20.25h3.375c1.035 0 1.875-.84 1.875-1.875V5.625c0-1.036-.84-1.875-1.875-1.875H16.5v16.5zM4.125 3.75H7.5v16.5H4.125a1.875 1.875 0 01-1.875-1.875V5.625c0-1.036.84-1.875 1.875-1.875z"}))}const ds=d.forwardRef(cs),us=ds;function fs(e){switch(e){case Z.SQL:return"SQL";case Z.PY:return"Python";case Z.YAML:case Z.YML:return"YAML";default:return"Plain Text"}}function ms(e,s){return e.file.extension===Z.SQL&&e.file.isLocal&&ke(s)}const F=function({text:s,children:l,className:n}){return t.jsxs("small",{className:b("font-bold whitespace-nowrap text-xs",n),children:[I(s)&&t.jsxs("span",{children:[s,": "]}),l]})};function xs({text:e,className:s}){return t.jsx("span",{className:b("font-normal",s),children:e})}function hs({ok:e,className:s}){return t.jsx("span",{className:b("inline-block w-2 h-2 rounded-full",B(e)&&"bg-warning-500",lt(e)&&"bg-success-500",R(e)&&"bg-danger-500",s)})}F.Text=xs;F.Light=hs;const O={Model:"model",Test:"test",Audit:"audit",Macro:"macro",Hook:"hook",Log:"log",Config:"config",Seed:"seed",Metric:"metric",Schema:"schema",Unknown:"unknown"};function ps({tab:e}){const s=D(i=>i.isModel),l=N(i=>i.engine),n=N(i=>i.dialects),c=N(i=>i.refreshTab);d.useEffect(()=>{var u;const i=(u=n[0])==null?void 0:u.dialect_name;B(e.dialect)&&I(i)&&r(i)},[n,e]);function r(i){e.dialect=i,c(e),l.postMessage({topic:"dialect",payload:e.dialect})}return t.jsxs("div",{className:"flex w-full items-center px-2 min-h-[2rem] overflow-hidden",children:[e.file.isRemote&&t.jsx(F,{className:"mr-2",text:"Saved",children:t.jsx(F.Light,{ok:R(e.file.isChanged)})}),e.file.isRemote&&e.file.isSQL&&t.jsx(F,{className:"mr-2",text:"Formatted",children:t.jsx(F.Light,{ok:e.file.isFormatted})}),t.jsx(F,{className:"mr-2",text:"Language",children:t.jsx(F.Text,{text:fs(e.file.extension)})}),ms(e,n)&&t.jsx(F,{className:"mr-2",text:"Dialect",children:t.jsx(E,{size:P.sm,children:({className:i,size:u})=>t.jsx(E.Selector,{className:i,size:u,list:n.map(p=>({text:p.dialect_title,value:de(p.dialect_name)?"sqlglot":p.dialect_name})),onChange:r,value:e.dialect})})}),s(e.file.path)&&!de(e.dialect)&&t.jsx(F,{className:"mr-2",text:"Dialect",children:t.jsx(F.Text,{text:e.dialect})}),t.jsx(F,{className:"mr-2",text:"SQLMesh Type",children:t.jsx(F.Text,{text:gs(e.file.path)})})]})}function gs(e){return de(e)?O.Unknown:e.startsWith("models")?O.Model:e.startsWith("tests")?O.Test:e.startsWith("logs")?O.Log:e.startsWith("macros")?O.Macro:e.startsWith("hooks")?O.Hook:e.startsWith("seeds")?O.Seed:e.startsWith("metrics")?O.Metric:["config.yaml","config.yml","config.py"].includes(e)?O.Config:["external_models.yaml","schema.yaml"].includes(e)?O.Schema:O.Unknown}function Ge({tab:e,title:s}){const l=d.useRef(null),n=D(g=>g.addConfirmation),c=ee(g=>g.setSelectedFile),r=N(g=>g.closeTab),i=N(g=>g.tab),u=e.file.id===(i==null?void 0:i.file.id);return d.useEffect(()=>{B(e)||(e.el=l.current??void 0)},[l,e]),d.useEffect(()=>{B(i)||setTimeout(()=>{var g;(g=i.el)==null||g.scrollIntoView({behavior:"smooth",inline:"center"})},300)},[i]),t.jsx("li",{ref:l,className:b("inline-block py-1 pr-2 last-child:pr-0 overflow-hidden text-center overflow-ellipsis cursor-pointer"),onClick:p,children:t.jsxs("span",{className:b("flex border-2 justify-between items-center pl-1 pr-1 py-[0.125rem] min-w-[8rem] rounded-md group border-transparent border-r border-r-theme-darker dark:border-r-theme-lighter",u?"bg-neutral-200 border-neutral-200 text-neutral-900 dark:bg-dark-lighter dark:border-dark-lighter dark:text-primary-500":"bg-trasparent hover:bg-theme-darker dark:hover:bg-theme-lighter"),children:[t.jsx("small",{className:"text-xs",children:s}),t.jsx("small",{className:b("group-hover:hidden text-xs inline-block ml-3 mr-1 w-2 h-2 rounded-full",e.file.isChanged?"bg-warning-500":"bg-transparent")}),t.jsx(pt,{className:"hidden group-hover:inline-block text-neutral-600 dark:text-neutral-100 w-4 h-4 ml-2 mr-0 cursor-pointer",onClick:a})]})});function p(g){g.stopPropagation(),c(e.file)}function a(g){g.stopPropagation(),f()}function f(){e.file.isChanged?n({headline:"Closing Tab",description:"All unsaved changes will be lost. Do you want to close the tab anyway?",yesText:"Yes, Close Tab",noText:"No, Cancel",action:()=>r(e.file)}):r(e.file)}}function bs(){const e=D(o=>o.modules),s=D(o=>o.models),l=D(o=>o.lastSelectedModel),n=D(o=>o.setLastSelectedModel),c=ee(o=>o.files),r=ee(o=>o.selectedFile),i=ee(o=>o.setSelectedFile),u=N(o=>o.tab),p=N(o=>o.tabs),a=N(o=>o.replaceTab),f=N(o=>o.createTab),g=N(o=>o.selectTab),w=N(o=>o.addTab),[x,v]=d.useMemo(()=>{const o=[],y=[];return p.forEach(m=>{m.file.isLocal&&o.push(m),m.file.isRemote&&y.push(m)}),[o,y]},[p]);return d.useEffect(()=>{if(B(r)||(u==null?void 0:u.file)===r||r instanceof xt||R(e.hasFiles))return;n(s.get(r.path));const o=f(r);I(u)&&u.file instanceof ht&&R(u.file.isChanged)&&u.file.isRemote&&R(p.has(r))?a(u,o):w(o),g(o)},[r,e]),d.useEffect(()=>{if(B(l))return;const o=c.get(l.path);B(o)||i(o)},[l]),t.jsxs("div",{className:"flex items-center bg-neutral-5",children:[t.jsx(A,{className:"h-6 m-0 ml-1 mr-2 border-none",variant:_.Alternative,size:P.sm,onClick:M,children:t.jsx(is,{className:"inline-block w-3 h-4"})}),t.jsxs("ul",{className:"w-full whitespace-nowrap min-h-[2rem] max-h-[2rem] overflow-hidden overflow-x-auto hover:scrollbar scrollbar--horizontal",children:[x.map((o,y)=>t.jsx(Ge,{tab:o,title:`Custom SQL ${y+1}`},o.id)),v.map(o=>t.jsx(Ge,{tab:o,title:o.file.name},o.id))]})]});function M(o){o.stopPropagation(),j()}function j(){const o=f();w(o),g(o),i(o.file)}}function Ae({list:e,children:s=[],className:l,disabled:n=!1}){return t.jsxs(k.List,{className:b("w-full whitespace-nowrap px-2 flex justify-center items-center",n&&"cursor-not-allowed"),children:[t.jsx("div",{className:b("flex w-full overflow-hidden overflow-x-auto py-1 hover:scrollbar scrollbar--horizontal",l,n&&"opacity-50 pointer-events-none"),children:t.jsx("div",{className:"flex p-1 items-center bg-secondary-10 dark:bg-primary-10 cursor-pointer rounded-full overflow-hidden",children:e.map(c=>t.jsx(k,{className:({selected:r})=>b("text-xs px-2 py-0.5 mr-2 last:mr-0 rounded-full relative align-middle",r?"bg-secondary-500 text-secondary-100 cursor-default font-bold":"cursor-pointer font-medium text-secondary-400 dark:text-secondary-400"),children:c},c))})}),s]})}const Ue=24*60*60*1e3,vs=1e3,je=50;function js({tab:e,isOpen:s=!0,toggle:l}){const n=D(i=>i.models),c=D(i=>i.isModel),r=d.useMemo(()=>n.get(e.file.path),[e,n]);return t.jsx("div",{className:b("flex flex-col w-full h-full items-center overflow-hidden"),children:c(e.file.path)?I(r)&&t.jsx(ws,{tab:e,model:r,isOpen:s,toggle:l}):t.jsx(Ns,{tab:e,isOpen:s,toggle:l})})}function ws({tab:e,model:s,isOpen:l=!0,toggle:n}){const c=D(u=>u.environment),r=D(u=>u.environments),i=Array.from(r).filter(({isRemote:u})=>u).map(({name:u})=>({text:u,value:u}));return t.jsxs(k.Group,{children:[t.jsxs("div",{className:"flex w-full items-center",children:[t.jsx(A,{className:b("h-6 w-6 !px-0 border-none bg-neutral-10 dark:bg-neutral-20",l?"text-secondary-500 dark:text-secondary-300":"text-neutral-500 dark:text-neutral-300"),variant:_.Info,size:P.sm,onClick:u=>{u.stopPropagation(),n==null||n()},children:t.jsx(et,{className:"w-4 h-4"})}),l&&t.jsx(Ae,{className:"flex justify-center items-center",list:["Evaluate","Columns",i.length>1&&c.isRemote&&"Diff"].filter(Boolean)})]}),l&&t.jsxs(k.Panels,{className:"h-full w-full overflow-hidden",children:[t.jsx(k.Panel,{unmount:!1,className:b("flex flex-col w-full h-full relative overflow-hidden","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(Es,{model:s})}),t.jsx(k.Panel,{unmount:!1,className:"text-xs w-full h-full ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2 px-2",children:t.jsx(Pt,{nodeId:s.fqn,columns:s.columns,disabled:R(s.isModelSQL),withHandles:!1,withSource:!1,withDescription:!0,limit:10})}),i.length>1&&c.isRemote&&t.jsx(k.Panel,{unmount:!1,className:b("flex flex-col w-full h-full relative overflow-hidden","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(Ps,{tab:e,model:s,list:i.filter(({value:u})=>c.name!==u),target:{text:c.name,value:c.name}})})]})]})}function Ns({tab:e,isOpen:s=!0,toggle:l}){return t.jsxs(k.Group,{children:[t.jsxs("div",{className:"flex w-full items-center",children:[t.jsx(A,{className:b("h-6 w-6 !px-0 border-none bg-neutral-10 dark:bg-neutral-20",s?"text-secondary-500 dark:text-secondary-300":"text-neutral-500 dark:text-neutral-300"),variant:_.Info,size:P.sm,onClick:n=>{n.stopPropagation(),l==null||l()},children:t.jsx(et,{className:"w-4 h-4"})}),s&&t.jsx(Ae,{className:"flex justify-center items-center",list:["Run Query","Diff"]})]}),s&&t.jsxs(k.Panels,{className:"h-full w-full overflow-hidden",children:[t.jsx(k.Panel,{unmount:!1,className:b("flex flex-col w-full h-full relative overflow-hidden","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(Ts,{tab:e})}),t.jsx(k.Panel,{unmount:!1,className:b("flex flex-col w-full h-full relative overflow-hidden","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(Ss,{})})]})]})}function ys({children:e}){return t.jsx("fieldset",{className:"flex my-3",children:e})}function Ne({children:e}){return t.jsx("div",{className:"flex w-full h-full py-1 overflow-hidden overflow-y-auto hover:scrollbar scrollbar--vertical",children:e})}function ye({children:e}){return t.jsx("div",{className:"flex w-full py-1 px-1 justify-end",children:e})}function Ts({tab:e}){const s=N(p=>p.setPreviewQuery),l=N(p=>p.setPreviewTable),n=N(p=>p.engine),{refetch:c,isFetching:r,cancel:i}=nt({sql:e.file.content});d.useEffect(()=>()=>{i()},[]);function u(){l(void 0),s(e.file.content),c().then(({data:p})=>{l(Re(p))})}return t.jsxs(t.Fragment,{children:[t.jsx(Ne,{}),t.jsx(re,{}),t.jsxs(ye,{children:[t.jsx(A,{size:P.sm,variant:_.Alternative,onClick:p=>{p.stopPropagation(),n.postMessage({topic:"format",payload:{sql:e.file.content,dialect:e.dialect}})},children:"Format"}),r?t.jsxs("div",{className:"flex items-center",children:[t.jsx(we,{className:"w-3"}),t.jsx("small",{className:"text-xs text-neutral-400 block mx-2",children:"Running Query..."}),t.jsx(A,{size:P.sm,variant:_.Danger,onClick:p=>{p.stopPropagation(),i()},children:"Cancel"})]}):t.jsx(A,{size:P.sm,variant:_.Alternative,disabled:r,onClick:p=>{p.stopPropagation(),u()},children:"Run Query"})]})]})}function Es({model:e}){const s=D(x=>x.environment),l=D(x=>x.isModel),n=N(x=>x.setPreviewQuery),c=N(x=>x.setPreviewTable),[r,i]=d.useState({model:e.displayName,start:Ee(Qe(Date.now()-Ue)),end:Ee(new Date),execution_time:Ee(Qe(Date.now()-Ue)),limit:1e3}),{refetch:u}=rt({model:r.model,start:r.start,end:r.end,execution_time:r.execution_time,dialect:e.dialect,pretty:!0}),{refetch:p,isFetching:a,cancel:f}=at(r),g=l(e.path)&&Object.values(r).every(Boolean);d.useEffect(()=>()=>{f()},[]);function w(){n(void 0),c(void 0),u().then(({data:x})=>{n(x==null?void 0:x.sql)}),p().then(({data:x})=>{c(Re(x))})}return t.jsxs(t.Fragment,{children:[t.jsx(Ne,{children:t.jsxs("form",{className:"w-full",children:[R(g)&&t.jsx(ys,{children:t.jsx(We,{variant:_.Warning,children:t.jsxs(We.Description,{className:"w-full mr-2 text-sm",children:["Please fill out all fields to ",t.jsx("b",{children:"evaluate the model"}),"."]})})}),t.jsxs("fieldset",{className:"px-2 w-full text-neutral-500",children:[t.jsx(E,{className:"w-full mx-0",label:"Start Date",size:P.sm,children:({className:x})=>t.jsx(E.Textfield,{className:b(x,"w-full"),placeholder:"02/11/2023",value:r.start,onInput:v=>{v.stopPropagation(),i({...r,start:v.target.value??""})}})}),t.jsx(E,{className:"w-full mx-0",label:"End Date",size:P.sm,children:({className:x})=>t.jsx(E.Textfield,{className:b(x,"w-full"),placeholder:"02/13/2023",value:r.end,onInput:v=>{v.stopPropagation(),i({...r,end:v.target.value??""})}})}),t.jsx(E,{className:"w-full mx-0",label:"Execution Time",size:P.sm,children:({className:x})=>t.jsx(E.Textfield,{className:b(x,"w-full"),placeholder:"02/13/2023",value:r.execution_time,onInput:v=>{v.stopPropagation(),i({...r,execution_time:v.target.value??""})}})}),I(r.limit)&&t.jsx(E,{className:"w-full mx-0",label:"Limit",size:P.sm,children:({className:x})=>t.jsx(E.Textfield,{className:b(x,"w-full"),type:"number",placeholder:"1000",value:r.limit,onInput:v=>{v.stopPropagation(),i({...r,limit:v.target.valueAsNumber??vs})}})})]})]})}),t.jsx(re,{}),t.jsx(ye,{children:t.jsx("div",{className:"flex w-full justify-end",children:l(e.path)&&a?t.jsxs("div",{className:"flex items-center",children:[t.jsx(we,{className:"w-3"}),t.jsx("small",{className:"text-xs text-neutral-400 block mx-2",children:"Evaluating..."}),t.jsx(A,{size:P.sm,variant:_.Danger,onClick:x=>{x.stopPropagation(),f()},children:"Cancel"})]}):t.jsx(A,{size:P.sm,variant:_.Alternative,disabled:R(g)||a||s.isInitialProd,onClick:x=>{x.stopPropagation(),w()},children:"Evaluate"})})})]})}function Ps({tab:e,model:s,list:l,target:n}){const c=D(m=>m.isModel),r=N(m=>m.setPreviewDiff),[i,u]=d.useState(l[0].value),[p,a]=d.useState(je),[f,g]=d.useState(""),[w,x]=d.useState(""),{refetch:v,isFetching:M,cancel:j}=qe({source:i,target:n.value,model_or_snapshot:s.name,limit:p,on:f,where:w}),o=d.useCallback(()=>{r(void 0),v().then(({data:m})=>{r(m)})},[s.name,s.hash]);d.useEffect(()=>()=>{j()},[]),d.useEffect(()=>{u(l[0].value)},[l]);const y=c(e.file.path)&&[i,n,p].every(Boolean);return t.jsxs(t.Fragment,{children:[t.jsx(Ne,{children:t.jsx("form",{className:"w-full",children:t.jsxs("fieldset",{className:"px-2 w-full text-neutral-500",children:[t.jsx(E,{className:"w-full mx-0",label:"Source",disabled:l.length<2,size:P.sm,children:({disabled:m,className:S})=>t.jsx(E.Selector,{className:b(S,"w-full"),list:l,value:i,disabled:m,onChange:u})}),t.jsx(E,{className:"w-full mx-0",label:"Target",disabled:!0,children:({disabled:m,className:S})=>t.jsx(E.Textfield,{className:b(S,"w-full"),disabled:m,value:n.value})}),t.jsx(E,{className:"w-full mx-0",label:"Limit",size:P.sm,children:({className:m})=>t.jsx(E.Textfield,{className:b(m,"w-full"),type:"number",placeholder:"1000",value:p,onInput:S=>{S.stopPropagation(),a(S.target.valueAsNumber??je)}})}),t.jsx(E,{className:"w-full mx-0",label:"ON",size:P.sm,children:({className:m})=>t.jsx(E.Textfield,{className:b(m,"w-full"),placeholder:"s.id = t.id",value:f,onInput:S=>{S.stopPropagation(),g(S.target.value)}})}),t.jsx(E,{className:"w-full mx-0",label:"WHERE",size:P.sm,children:({className:m})=>t.jsx(E.Textfield,{className:b(m,"w-full"),placeholder:"id > 10",value:w,onInput:S=>{S.stopPropagation(),x(S.target.value)}})})]})})}),t.jsx(re,{}),t.jsx(ye,{children:t.jsx("div",{className:"flex w-full justify-end items-center px-2",children:M?t.jsxs("div",{className:"flex items-center",children:[t.jsx(we,{className:"w-3"}),t.jsx("small",{className:"text-xs text-neutral-400 block mx-2",children:"Getting Diff..."}),t.jsx(A,{size:P.sm,variant:_.Danger,onClick:m=>{m.stopPropagation(),j()},children:"Cancel"})]}):t.jsx(A,{className:"ml-2",size:P.sm,variant:_.Alternative,disabled:R(y)||M,onClick:m=>{m.stopPropagation(),o()},children:"Get Diff"})})})]})}function Ss(){const e=N(j=>j.setPreviewDiff),[s,l]=d.useState(""),[n,c]=d.useState(""),[r,i]=d.useState(je),[u,p]=d.useState(""),[a,f]=d.useState(""),{refetch:g,isFetching:w,cancel:x}=qe({source:s,target:n,limit:r,on:u,where:a});d.useEffect(()=>()=>{x()},[]);function v(){e(void 0),g().then(({data:j})=>{e(j)})}const M=[s,n,r,u].every(Boolean);return t.jsxs(t.Fragment,{children:[t.jsx(Ne,{children:t.jsx("form",{className:"w-full",children:t.jsxs("fieldset",{className:"px-2 w-full text-neutral-500",children:[t.jsx(E,{className:"w-full mx-0",label:"Source",size:P.sm,children:({className:j})=>t.jsx(E.Textfield,{className:b(j,"w-full"),placeholder:"exp.tst_model__dev",value:s,onInput:o=>{o.stopPropagation(),l(o.target.value)}})}),t.jsx(E,{className:"w-full mx-0",label:"Target",size:P.sm,children:({className:j})=>t.jsx(E.Textfield,{className:b(j,"w-full"),placeholder:"exp.tst_snapshot__1353336088",value:n,onInput:o=>{o.stopPropagation(),c(o.target.value)}})}),t.jsx(E,{className:"w-full mx-0",label:"Limit",size:P.sm,children:({className:j})=>t.jsx(E.Textfield,{className:b(j,"w-full"),type:"number",placeholder:"1000",value:r,onInput:o=>{o.stopPropagation(),i(o.target.valueAsNumber??je)}})}),t.jsx(E,{className:"w-full mx-0",label:"ON",size:P.sm,children:({className:j})=>t.jsx(E.Textfield,{className:b(j,"w-full"),placeholder:"s.id = t.id",value:u,onInput:o=>{o.stopPropagation(),p(o.target.value)}})}),t.jsx(E,{className:"w-full mx-0",label:"WHERE",size:P.sm,children:({className:j})=>t.jsx(E.Textfield,{className:b(j,"w-full"),placeholder:"id > 10",value:a,onInput:o=>{o.stopPropagation(),f(o.target.value)}})})]})})}),t.jsx(re,{}),t.jsx(ye,{children:w?t.jsxs("div",{className:"flex items-center",children:[t.jsx(we,{className:"w-3"}),t.jsx("small",{className:"text-xs text-neutral-400 block mx-2",children:"Getting Diff..."}),t.jsx(A,{size:P.sm,variant:_.Danger,onClick:j=>{j.stopPropagation(),x()},children:"Cancel"})]}):t.jsx(A,{className:"ml-2",size:P.sm,variant:_.Alternative,disabled:R(M)||w,onClick:j=>{j.stopPropagation(),v()},children:"Get Diff"})})]})}const xe="s__",he="t__",ze="NULL";function Cs({source_schema:e,target_schema:s},l,n){const c=Array.from(new Set(n.flat())),r=Object.keys(e),i=Object.keys(s),p=Array.from(new Set(r.concat(i))).filter(g=>r.includes(g)&&i.includes(g)),a=r.filter(g=>!i.includes(g)),f=i.filter(g=>!r.includes(g));return{all:Array.from(new Set([c,l.modifiedColumns&&p,l.addedColumns&&f,l.removedColumns&&a].filter(Boolean).flat())),added:f.length,deleted:a.length,modified:p.length-c.length}}function Is(e,s,l){const n=Object.values(e.row_diff.sample)[0]??{},c=[],r=[],i=[];return Object.keys(n).forEach(u=>{X(e,u,l)?r.push(u):Y(e,u,l)?c.push(u):i.push(u)}),{all:[s.modifiedRows&&i,s.addedRows&&r,s.removedRows&&c].filter(Boolean).flat(),added:r.length,deleted:c.length,modified:i.length}}function Me(e,s,l){const n=G(e,xe,s,l),c=G(e,he,s,l);return n!==c}function Y(e,s,l){return l.every(([n,c])=>{const r=G(e,xe,n,s),i=G(e,he,c,s);return I(r)&&B(i)})}function X(e,s,l){return l.every(([n,c])=>{const r=G(e,xe,n,s),i=G(e,he,c,s);return B(r)&&I(i)})}function Ce(e,s,l,n){return l in e.schema_diff.added||l in e.schema_diff.removed?!1:s.some(c=>R(X(e,c,n))&&R(Y(e,c,n))&&Me(e,l,c))}function G(e,s,l,n){var c;return(c=e.row_diff.sample[`${s}${l}`])==null?void 0:c[n]}function ks(e,s,l){return G(e,xe,s,l)??ze}function Ds(e,s,l){return G(e,he,s,l)??ze}function Ms({diff:e}){const[s,l]=d.useState({modifiedRows:!0,addedRows:!0,removedRows:!0,modifiedColumns:!0,addedColumns:!0,removedColumns:!0}),n=Cs(e.schema_diff,s,e.on),c=Is(e,s,e.on),r=s.addedRows&&!s.removedRows&&!s.modifiedRows,i=!s.addedRows&&s.removedRows&&!s.modifiedRows,u=Array.from(new Set(e.on.flat())),p=Object.values(e.row_diff.sample).some(a=>Object.keys(a).length>0);return t.jsxs("div",{className:"px-2 h-full flex flex-col rounded-lg",children:[p&&t.jsxs(t.Fragment,{children:[t.jsx(_s,{diff:e,rows:c,columns:n}),t.jsx("div",{className:"mt-2 mb-1 flex rounded-lg items-center",children:t.jsx("div",{className:"w-full flex justify-end items-center",children:t.jsx(gt,{options:Object.keys(s).reduce((a,f)=>(a[f]=g=>l(w=>({...w,[f]:g})),a),{}),value:Object.keys(s).map(a=>R(s[a])?void 0:a).filter(Boolean)})})})]}),t.jsx("div",{className:"overflow-auto h-full hover:scrollbar scrollbar--horizontal scrollbar--vertical",children:t.jsxs("table",{cellPadding:0,cellSpacing:0,className:"w-full text-xs text-neutral-600 dark:text-neutral-200 font-normal border-separate",children:[t.jsx("thead",{className:"sticky bg-theme top-0 z-10",children:t.jsx("tr",{children:n.all.map(a=>t.jsx("th",{colSpan:Ce(e,c.all,a,e.on)?2:1,className:b("text-left whitespace-nowrap py-1 px-2 font-bold",a in e.schema_diff.added?"border-t-2 border-l-2 border-r-2 border-success-500":a in e.schema_diff.removed?"border-t-2 border-l-2 border-r-2 border-danger-500":u.includes(a)?"border-brand-500 border-l-2 border-t-2 border-r-2":"border-r border-b border-neutral-100 dark:border-neutral-700 last:border-r-0",u.includes(a)?"bg-brand-10":"bg-neutral-5"),children:t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("div",{className:"mr-2",children:[t.jsx("span",{children:a})," ",t.jsxs("small",{className:"text-neutral-500 font-medium",children:["(",e.schema_diff.source_schema[a]??e.schema_diff.target_schema[a],")"]})]}),R(u.includes(a))&&t.jsx("div",{className:"ml-2",children:t.jsxs("small",{className:"inline-block bg-neutral-10 px-2 py-0.5 rounded-full",children:[Math.round(c.all.filter(f=>Me(e,a,f)).length/c.all.length*100),"%"]})})]})},a))})}),t.jsx("tbody",{children:ke(c.all)?c.all.map(a=>t.jsx("tr",{children:n.all.map(f=>Ce(e,c.all,f,e.on)?t.jsxs(t.Fragment,{children:[t.jsx("td",{className:b("p-1 border-r border-b border-neutral-100 dark:border-neutral-700 last:border-r-0",X(e,a,e.on)&&"bg-success-10 text-success-500",Y(e,a,e.on)&&"bg-danger-5 text-danger-500"),children:t.jsx("div",{className:b("px-2 py-1 whitespace-nowrap font-bold rounded-md ",X(e,a,e.on)&&"bg-success-10 text-success-500",Y(e,a,e.on)&&"bg-danger-5 text-danger-500"),children:ks(e,f,a)})},`${a}-${f}-source`),t.jsx("td",{className:b("p-1 border-r border-b border-neutral-100 dark:border-neutral-700 last:border-r-0",X(e,a,e.on)&&"bg-success-10 text-success-500",Y(e,a,e.on)&&"bg-danger-5 text-danger-500"),children:t.jsx("div",{className:b("px-2 py-1 whitespace-nowrap font-bold rounded-md",Me(e,f,a)&&"bg-primary-10 text-primary-500",X(e,a,e.on)&&"!bg-success-10 !text-success-500",Y(e,a,e.on)&&"!bg-danger-5 !text-danger-500"),children:Ds(e,f,a)})},`${a}-${f}-target`)]}):t.jsx("td",{className:b("p-1",f in e.schema_diff.added?"bg-success-10 border-l-2 border-r-2 border-success-500 text-success-500 font-bold":f in e.schema_diff.removed?"bg-danger-5 border-l-2 border-r-2 border-danger-500 !text-danger-500 font-bold":u.includes(f)?"border-brand-500 border-l-2 border-r-2":"border-r border-b border-neutral-100 dark:border-neutral-700 last:border-r-0",Y(e,a,e.on)&&"!bg-danger-5 text-danger-500 font-bold",X(e,a,e.on)&&"bg-success-10 text-success-500 font-bold"),children:t.jsx("div",{className:b("px-2 py-1 whitespace-nowrap rounded-md",(f in e.schema_diff.added||X(e,a,e.on))&&"bg-success-10 text-success-500 font-bold",(f in e.schema_diff.removed||Y(e,a,e.on))&&"!bg-danger-5 !text-danger-500 font-bold"),children:G(e,xe,f,a)??G(e,he,f,a)??ze})},`${a}-${f}`))},a)):t.jsx(yt,{columns:n.all.length>0?n.all.length:void 0})}),ke(c.all)&&t.jsx("tfoot",{className:"sticky bg-theme bottom-0",children:t.jsx("tr",{children:n.all.map(a=>Ce(e,c.all,a,e.on)?t.jsxs(t.Fragment,{children:[t.jsx("th",{className:b("text-left whitespace-nowrap px-2 py-1 border-r border-t border-neutral-100 dark:border-neutral-700 last:border-r-0",u.includes(a)?"bg-brand-10":"bg-neutral-10"),children:"Source"},`${a}-source`),t.jsx("th",{className:b("text-left whitespace-nowrap px-2 py-1 border-r border-t border-neutral-100 dark:border-neutral-700 last:border-r-0",u.includes(a)?"bg-brand-10":"bg-primary-10"),children:"Target"},`${a}-target`)]}):t.jsxs("th",{className:b("text-left whitespace-nowrap px-2 py-1 font-bold",a in e.schema_diff.added?"border-b-2 border-l-2 border-r-2 border-success-500":a in e.schema_diff.removed?"border-b-2 border-l-2 border-r-2 border-danger-500":u.includes(a)?"border-brand-500 border-l-2 border-b-2 border-r-2":"border-r border-t border-neutral-100 dark:border-neutral-700 last:border-r-0",u.includes(a)?"bg-brand-10":"bg-neutral-10"),children:[(a in e.schema_diff.removed||i)&&t.jsx("span",{children:"Source"}),(a in e.schema_diff.added||r)&&t.jsx("span",{children:"Target"})]},a))})})]})}),t.jsxs("div",{className:"flex justify-between items-center px-2 mt-2",children:[t.jsx(Tt,{count:c.all.length}),t.jsx(Rs,{})]})]})}function Rs(){const e=[["Grain","bg-brand-500"],["Changed","bg-primary-500"],["Added","bg-success-500"],["Deleted","bg-danger-500"]];return t.jsx("div",{className:"flex text-xs",children:e.map(([s="",l])=>t.jsx(Ls,{text:s,className:l},s))})}function Ls({text:e,className:s}){return t.jsxs("div",{className:"flex ml-2 items-center",children:[t.jsx("span",{className:b("inline-block w-3 h-3 mr-2 rounded-full",s)}),t.jsx("small",{className:"text-neutral-600 dark:text-neutral-400",children:e})]})}function _s({diff:e,rows:s,columns:l}){return t.jsx(Se,{defaultOpen:!1,children:({open:n})=>t.jsxs(t.Fragment,{children:[t.jsxs(Se.Button,{className:"flex items-center w-full justify-between rounded-lg text-left text-sm px-4 pt-3 pb-2 bg-neutral-10 hover:bg-theme-darker dark:hover:bg-theme-lighter text-neutral-600 dark:text-neutral-400",children:[t.jsx("h2",{className:"whitespace-nowrap text-xl font-bold mb-1",children:"Stats"}),n?t.jsx(kt,{className:"h-6 w-6 text-primary-500"}):t.jsx(Dt,{className:"h-6 w-6 text-primary-500"})]}),t.jsx(Se.Panel,{className:"px-4 pb-2 text-sm text-neutral-500",children:t.jsxs("div",{className:"p-2 grid grid-cols-3 gap-4 mb-3",children:[t.jsx(Ie,{text:"Row Count Change",children:t.jsxs("p",{className:"text-6xl font-light text-primary-500 mt-3",children:[Math.round(Math.abs(e.row_diff.count_pct_change)),t.jsx("small",{className:"text-sm",children:"%"})]})}),t.jsxs(Ie,{text:"Column Count Change",count:s.all.length,children:[t.jsx("p",{className:"text-center text-6xl font-light text-primary-500 mt-3",children:s.modified}),t.jsx("p",{className:"text-center text-6xl font-light text-success-500 mt-3",children:s.added}),t.jsx("p",{className:"text-center text-6xl font-light text-danger-500 mt-3",children:s.deleted})]}),t.jsxs(Ie,{text:"Column Changes",count:l.all.length,children:[t.jsx("p",{className:"text-center text-6xl font-light text-primary-500 mt-3",children:l.modified}),t.jsx("p",{className:"text-center text-6xl font-light text-success-500 mt-3",children:l.added}),t.jsx("p",{className:"text-center text-6xl font-light text-danger-500 mt-3",children:l.deleted})]})]})})]})})}function Ie({text:e,children:s,className:l,count:n}){return t.jsxs("div",{className:b("rounded-xl overflow-hidden px-3 py-6 bg-primary-10",l),children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("h3",{className:"text-neutral-500 dark:text-neutral-300 text-sm font-bold",children:e}),I(n)&&t.jsx("div",{children:t.jsx("small",{className:"inline-block px-2 py-0.5 bg-neutral-10 rounded-full",children:n})})]}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:s})]})}const Fs=d.lazy(async()=>await ot(()=>import("./ModelLineage-d6235abf.js"),[])),V={Query:"Query",Table:"Data Preview",Console:"Logs",Lineage:"Lineage",Diff:"Diff",Errors:"Errors"};function As({tab:e,className:s}){const{errors:l,removeError:n}=Ve(),c=it(),r=D(m=>m.models),i=D(m=>m.isModel),u=N(m=>m.direction),p=N(m=>m.previewQuery),a=N(m=>m.previewTable),f=N(m=>m.previewDiff),g=N(m=>m.setDirection),[w,x]=d.useState(-1),v=Je(e.file.path,m=>{c(`${ct.DataCatalogModels}/${m.name}`)}),M=r.get(e.file.path),j=R(e.file.isEmpty)&&I(M)&&i(e.file.path),o=l.size>0,y=d.useMemo(()=>[I(a)&&V.Table,I(p)&&e.file.isRemote&&V.Query,j&&V.Lineage,I(f)&&V.Diff,o&&V.Errors].filter(Boolean),[e.id,a,p,f,j,l,o]);return d.useEffect(()=>{I(a)?x(y.indexOf(V.Table)):x(0)},[a]),d.useEffect(()=>{I(f)?x(y.indexOf(V.Diff)):x(0)},[f]),d.useEffect(()=>{I(j)?x(y.indexOf(V.Lineage)):x(0)},[j]),d.useEffect(()=>{x(o?y.indexOf(V.Errors):0)},[o]),d.useEffect(()=>{for(const m of l)dt([Q.Fetchdf,Q.EvaluateModel,Q.RenderQuery,Q.ColumnLineage,Q.ModelLineage,Q.TableDiff,Q.Table,Q.SaveFile],m.key)&&n(m)},[a,f,p,j]),t.jsx("div",{className:b("w-full h-full flex flex-col text-prose overflow-auto hover:scrollbar scrollbar--vertical",s),children:ut(y)?t.jsx("div",{className:"flex justify-center items-center w-full h-full",children:t.jsx("h3",{className:"text-md",children:"No Data To Preview"})}):t.jsxs(k.Group,{onChange:x,selectedIndex:w,children:[t.jsx(Ae,{list:y,children:t.jsx("div",{className:"ml-2",children:t.jsx(A,{className:"!m-0 !py-0.5 px-[0.25rem] border-none",variant:_.Alternative,size:P.sm,onClick:()=>{g(u==="horizontal"?"vertical":"horizontal")},children:t.jsx(us,{"aria-label":u==="horizontal"?"Use vertical layout":"Use horizontal layout",className:"text-primary-500 w-5"})})})},y.join("-")),t.jsxs(k.Panels,{className:"h-full w-full overflow-hidden",children:[I(a)&&t.jsx(k.Panel,{unmount:!1,className:b("w-full h-full pt-4 relative px-2","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(Et,{data:a})}),I(p)&&e.file.isRemote&&t.jsx(k.Panel,{unmount:!1,className:"w-full h-full ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2 p-2",children:t.jsx("div",{className:"w-full h-full p-2 bg-primary-10 rounded-lg overflow-auto hover:scrollbar scrollbar--horizontal scrollbar--vertical",children:t.jsx(De,{type:Z.SQL,content:p??"",extensions:v,className:"text-xs"})})}),j&&t.jsx(k.Panel,{unmount:!1,className:b("w-full h-full ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(d.Suspense,{fallback:t.jsx(ft,{children:"Loading Model page..."}),children:t.jsx(Fs,{model:M})})}),I(f==null?void 0:f.row_diff)&&t.jsx(k.Panel,{unmount:!1,className:b("w-full h-full ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2 py-2"),children:t.jsx(Ms,{diff:f},e.id)}),o&&t.jsx(k.Panel,{unmount:!1,className:"w-full h-full ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2 py-2",children:t.jsx("ul",{className:"w-full h-full p-2 overflow-auto hover:scrollbar scrollbar--vertical scrollbar--horizontal",children:Array.from(l).reverse().map(m=>t.jsx("li",{className:"bg-danger-10 mb-4 last:m-0 p-2 rounded-md",children:t.jsx(Mt,{scope:m.key,error:m})},m.id))})})]})]},e.id)})}const be=32,zs=2;function $e(){const e=N(s=>s.tab);return t.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",children:[t.jsx(bs,{}),t.jsx(re,{}),B(e)?t.jsx(Oe,{}):t.jsx(tt,{tab:e})]})}function Oe(){return t.jsx("div",{className:"flex justify-center items-center w-full h-full",children:t.jsx("div",{className:"p-4 text-center text-theme-darker dark:text-theme-lighter",children:t.jsx("h2",{className:"text-3xl",children:"Select File or Add New SQL Tab"})})})}function tt({tab:e}){const{errors:s,addError:l,removeError:n}=Ve(),c=D(h=>h.environment),r=D(h=>h.models),i=D(h=>h.isModel),u=ee(h=>h.files),p=ee(h=>h.selectedFile),a=ee(h=>h.setSelectedFile),f=N(h=>h.direction),g=N(h=>h.engine),w=N(h=>h.previewTable),x=N(h=>h.previewDiff),v=N(h=>h.refreshTab),M=N(h=>h.updateStoredTabsIds),j=N(h=>h.setPreviewQuery),o=N(h=>h.setPreviewTable),y=N(h=>h.setPreviewDiff),m=N(h=>h.setDialects),{setManuallySelectedColumn:S}=St(),U=d.useCallback(function(h){a(u.get(h.path))},[u]),ae=d.useCallback(function(h,L){S([h,L])},[]),J=Ct(),C=Je(e.file.path,U,ae),[z,T]=d.useState(!1),$=d.useMemo(()=>[...J,{key:"Mod-Enter",win:"Ctrl-Enter",preventDefault:!0,stopPropagation:!0,run(h){const L=h.state.doc.toString();o(void 0),j(L);for(const q of s)q.key===Q.Fetchdf&&n(q);return mt({sql:L}).then(q=>{o(Re(q))}).catch(q=>{l(Q.Fetchdf,{...q,errorKey:Q.Fetchdf,trigger:"Editor -> customSQLKeymaps",message:q.message,timestamp:Date.now(),origin:"useQueryTimeout"})}),!0}}],[J,s]);d.useEffect(()=>{T(!1),B(p)&&a(e==null?void 0:e.file)},[e.id]),d.useEffect(()=>(g.addEventListener("message",pe),()=>{g.removeEventListener("message",pe)}),[e.id,e.dialect]),d.useEffect(()=>{j(void 0),o(void 0),y(void 0),M()},[e.id,e.file.fingerprint]),d.useEffect(()=>{y(void 0)},[c]);function te(){const h=r.get(e.file.path),L=R(e.file.isEmpty)&&I(h)&&i(e.file.path);return s.size>0||[w,x].some(Boolean)||L?[70,30]:[100,0]}function Te(){const h=r.get(e==null?void 0:e.file.path);return z&&(I(h)&&i(e.file.path)||e.file.isLocal)&&R(de(e.file.content))?[70,30]:[100,0]}function oe(h){e.file.content=h,v(e)}function pe(h){if(h.data.topic==="dialects"){const L=r.get(e.file.path);e.dialect=(L==null?void 0:L.dialect)??e.dialect??"",m(h.data.payload),v(e)}if(h.data.topic==="format"){if(de(h.data.payload))return;e.file.content=h.data.payload,v(e)}}return t.jsxs(Be,{className:b("w-full h-full overflow-hidden",f==="vertical"?"flex flex-col":"flex"),sizes:te(),direction:f,minSize:[be,0],snapOffset:0,children:[t.jsxs("div",{className:b("flex flex-col",f==="vertical"?"w-full ":"h-full"),children:[t.jsxs(Be,{className:"flex h-full overflow-hidden",sizes:Te(),minSize:be,snapOffset:be,handleDrag:(h,L)=>{const st=L.parent.getBoundingClientRect().width*(h[1]??0)/100;T(st>=be+zs)},children:[t.jsxs("div",{className:"flex flex-col h-full",children:[e.file.isLocal&&t.jsx(De,{type:Z.SQL,dialect:e.dialect,keymaps:$,content:e.file.content,extensions:C,onChange:oe}),e.file.isRemote&&t.jsx(It,{keymaps:J,path:e.file.path,children:({file:h,keymaps:L})=>t.jsx(De,{type:h.extension,dialect:e.dialect,extensions:C,keymaps:L,content:h.content,onChange:oe})})]}),t.jsx("div",{className:"flex flex-col h-full",children:t.jsx(js,{tab:e,toggle:()=>T(h=>!h),isOpen:z})})]},e.id),t.jsx(re,{}),t.jsx(ps,{tab:e},e.file.fingerprint)]}),t.jsx(As,{tab:e,className:b(f==="vertical"?"flex flex-col":"flex")})]},f)}$e.Empty=Oe;$e.Loading=Oe;$e.Main=tt;export{$e as default};
